(()=>{"use strict";var e={208:(e,t,n)=>{n.d(t,{A:()=>h});var r=n(601),a=n.n(r),i=n(314),s=n.n(i),o=n(417),l=n.n(o),d=new URL(n(65),n.b),c=s()(a());c.push([e.id,"@import url(https://fonts.googleapis.com/css2?family=Roboto+Mono:wght@500&display=swap);"]);var p=l()(d);c.push([e.id,`:root {\n  --svg-light-filter: invert(2%) sepia(30%) saturate(7484%) hue-rotate(224deg) brightness(90%) contrast(101%);\n  --svg-filter: var(--svg-light-filter);\n  --dark950: #2d2d2d; /* Very dark gray */\n  --dark800: #4a4a4a; /* Dark gray */\n  --light200: #eaeaea; /* Light gray */\n  --mid: #a8a8a8; /* Mid-tone gray */\n  --hit: #d3d3d3; /* Light gray for hits */\n  --sunk: #bababa; /* Slightly darker gray for sunk */\n  --miss: #ada9a9; /* Near-white for misses */\n  --canPlace: #c4c4c4; /* Neutral light gray for valid placements */\n  --cantPlace: rgba(186, 186, 186, 0.8); /* Semi-transparent darker gray */\n  --buttonColor: #6e6e6e; /* Muted gray for buttons */\n}\n\nhtml {\n  height: 100%;\n  /*font-family: "Pacifico", cursive;*/\n  font-family: "Roboto Mono", monospace;\n  font-weight: 500;\n}\n\nbody {\n  color: var(--dark800);\n  display: grid;\n  height: 100%;\n  margin: 0;\n  background-color: var(--light200);\n}\n\nbody h1 {\n  position: absolute;\n  justify-self: center;\n}\n\n.container {\n  height: 100%;\n  padding: 0;\n  display: flex;\n  flex-direction: column;\n  justify-content: center;\n  align-items: center;\n  margin-top: 50px;\n}\n\n.mainMenuContainer {\n  background-color: var(--dark800);\n  display: grid;\n  height: clamp(500px, 50%, 600px);\n  width: clamp(500px, 50%, 600px);\n  border-radius: 16px;\n  align-items: center;\n  justify-items: center;\n  gap: 16px;\n  margin-top: 50px;\n}\n\n.opponentTypeArea,\n.opponentTypeArea div {\n  display: flex;\n}\n\n.opponentTypeArea {\n  flex-direction: column;\n  align-items: center;\n}\n\n.opponentTypeArea input[type="radio"] {\n  display: none;\n}\n\n.pushable {\n  background-color: var(--dark950);\n  border-radius: 12px;\n  border: none;\n  padding: 0;\n  cursor: pointer;\n  outline-offset: 4px;\n}\n\n.front {\n  display: block;\n  font-size: 1.2rem;\n  font-weight: 500;\n  padding: 12px 42px;\n  background-color: var(--buttonColor); \n  color: white;\n  transform: translateY(-4px);\n  will-change: transform;\n  transition: 250ms;\n}\n\n.pushable .front {\n  border-radius: 12px;\n}\n\n.pushable:focus:not(:focus-visible) {\n  outline: none;\n}\n\n.pushable:hover .front {\n  transform: translateY(-6px);\n}\n\n.pushable:active .front {\n  transform: translateY(-2px);\n}\n\n.rightLabel,\n.leftLabel {\n  background-color: var(--dark950);\n  border: none;\n  padding: 0;\n  cursor: pointer;\n  outline-offset: 4px;\n  width: 50%;\n}\n\n.leftLabel .front,\n.leftLabel {\n  border-radius: 12px 0 0 12px;\n}\n\n.rightLabel,\n.rightLabel .front {\n  border-radius: 0 12px 12px 0;\n}\n\ninput:checked+.rightLabel .front,\ninput:checked+.leftLabel .front {\n  transform: translateY(-2px);\n}\n\n.boardsArea {\n  display: grid;\n  grid-template-columns: 1fr 1fr;\n  gap: 10vw;\n  align-items: center;\n  justify-content: center;\n}\n\n.editBoard {\n  grid-column: 1 / span 2;\n  position: relative;\n  align-self: center;\n  justify-self: center;\n  padding: 1rem;\n  display: flex;\n  gap: 2rem;\n  border-radius: 16px;\n  background-color: var(--mid);\n  color: var(--light200);\n}\n\n.editBoard .editBoardArea {\n  background-color: var(--light200);\n  z-index: 1;\n}\n\n@media only screen and (max-width: 600px) {\n  .editBoard {\n    flex-wrap: wrap;\n    justify-content: center;\n    margin: 0 8px;\n  }\n\n  .editBoard .editBoardArea+div {\n    width: auto !important;\n  }\n}\n\n@media only screen and (max-width: 900px) {\n  body {\n    grid-template-rows: auto 1fr;\n  }\n\n  .container {\n    margin-top: 0;\n  }\n\n  .mainMenuContainer {\n    width: 80%;\n    min-width: 450px;\n  }\n\n  body h1 {\n    position: relative;\n  }\n\n  .boardsArea {\n    display: flex;\n    flex-wrap: wrap;\n  }\n}\n\n.gameBoard {\n  border: 2px solid var(--dark800);\n  height: clamp(400px, 25vw, 25vw);\n  width: clamp(400px, 25vw, 25vw);\n  display: flex;\n  flex-wrap: wrap;\n}\n\n.P1 {\n  grid-column: 1 / span 1;\n  grid-row: 1;\n}\n\n.P2 {\n  grid-column: 2 / span 1;\n  grid-row: 1;\n}\n\n.tile {\n  height: 10%;\n  width: 10%;\n  box-sizing: border-box;\n  border: 2px solid var(--dark800);\n}\n\n.cell {\n  position: relative;\n  height: 100%;\n  width: 100%;\n}\n\n.hit {\n  background-color: var(--hit);\n  background-image: url(${p}); /* Path to the cross image */\n  background-size: cover; /* Adjust size to fill the tile */\n  background-position: center; /* Position the image in the center */\n  display: block;\n  width: 100%;\n  height: 100%;\n}\n\n.sunk {\n  background-color: var(--sunk);\n  display: flex;\n  align-content: center;\n  color: #0f172a;\n}\n\n.miss {\n  background-color: var(--miss);\n}\n\n.switchBtn {\n  position: absolute;\n  align-self: center;\n  justify-self: center;\n}\n\n.ship {\n  position: absolute;\n  top: 0;\n  left: 0;\n  margin: 0;\n  padding: 0;\n  z-index: 5;\n  transform-origin: center;\n}\n\n.editBoard .editBoardArea+div {\n  width: 6rem;\n}\n\n.shipImg {\n  transform-origin: center;\n  position: relative;\n}\n\n.edit .shipImg:hover {\n  opacity: 50%;\n}\n\n.movingShip .ship {\n  z-index: -1;\n}\n\n.canPlace,\n.cantPlace {\n  z-index: 9;\n  opacity: 100% !important;\n}\n\n.canPlace {\n  background-color: var(--canPlace) !important;\n}\n\n.cantPlace {\n  background-color: var(--cantPlace) !important;\n}\n\n.btnsDiv,\n.msgArea {\n  margin: 2rem;\n  display: grid;\n  grid-template-columns: 1fr 1fr;\n  gap: 2rem;\n}\n\n.btnsDiv h2,\n.msgArea h2 {\n  grid-column: 1 / span 2;\n  text-align: center;\n}\n\n.gameOverDia[open=""] {\n  color: var(--dark950);\n  z-index: 11;\n  padding: 32px;\n  display: flex;\n  flex-direction: column;\n  gap: 2rem;\n  align-items: center;\n  justify-content: space-between;\n  border: 0;\n  border-radius: 16px;\n  background-color: rgba(130, 140, 141, 1.0);\n}\n\n.closeDiaBtn {\n  border: 0;\n  background: transparent;\n  position: absolute;\n  top: 5px;\n  right: 5px;\n}\n\n.closeBtnImg {\n  height: 30px;\n  width: auto;\n  filter: var(--svg-filter);\n}`,""]);const h=c},314:e=>{e.exports=function(e){var t=[];return t.toString=function(){return this.map((function(t){var n="",r=void 0!==t[5];return t[4]&&(n+="@supports (".concat(t[4],") {")),t[2]&&(n+="@media ".concat(t[2]," {")),r&&(n+="@layer".concat(t[5].length>0?" ".concat(t[5]):""," {")),n+=e(t),r&&(n+="}"),t[2]&&(n+="}"),t[4]&&(n+="}"),n})).join("")},t.i=function(e,n,r,a,i){"string"==typeof e&&(e=[[null,e,void 0]]);var s={};if(r)for(var o=0;o<this.length;o++){var l=this[o][0];null!=l&&(s[l]=!0)}for(var d=0;d<e.length;d++){var c=[].concat(e[d]);r&&s[c[0]]||(void 0!==i&&(void 0===c[5]||(c[1]="@layer".concat(c[5].length>0?" ".concat(c[5]):""," {").concat(c[1],"}")),c[5]=i),n&&(c[2]?(c[1]="@media ".concat(c[2]," {").concat(c[1],"}"),c[2]=n):c[2]=n),a&&(c[4]?(c[1]="@supports (".concat(c[4],") {").concat(c[1],"}"),c[4]=a):c[4]="".concat(a)),t.push(c))}},t}},417:e=>{e.exports=function(e,t){return t||(t={}),e?(e=String(e.__esModule?e.default:e),/^['"].*['"]$/.test(e)&&(e=e.slice(1,-1)),t.hash&&(e+=t.hash),/["'() \t\n]|(%20)/.test(e)||t.needQuotes?'"'.concat(e.replace(/"/g,'\\"').replace(/\n/g,"\\n"),'"'):e):e}},601:e=>{e.exports=function(e){return e[1]}},72:e=>{var t=[];function n(e){for(var n=-1,r=0;r<t.length;r++)if(t[r].identifier===e){n=r;break}return n}function r(e,r){for(var i={},s=[],o=0;o<e.length;o++){var l=e[o],d=r.base?l[0]+r.base:l[0],c=i[d]||0,p="".concat(d," ").concat(c);i[d]=c+1;var h=n(p),u={css:l[1],media:l[2],sourceMap:l[3],supports:l[4],layer:l[5]};if(-1!==h)t[h].references++,t[h].updater(u);else{var m=a(u,r);r.byIndex=o,t.splice(o,0,{identifier:p,updater:m,references:1})}s.push(p)}return s}function a(e,t){var n=t.domAPI(t);n.update(e);return function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap&&t.supports===e.supports&&t.layer===e.layer)return;n.update(e=t)}else n.remove()}}e.exports=function(e,a){var i=r(e=e||[],a=a||{});return function(e){e=e||[];for(var s=0;s<i.length;s++){var o=n(i[s]);t[o].references--}for(var l=r(e,a),d=0;d<i.length;d++){var c=n(i[d]);0===t[c].references&&(t[c].updater(),t.splice(c,1))}i=l}}},659:e=>{var t={};e.exports=function(e,n){var r=function(e){if(void 0===t[e]){var n=document.querySelector(e);if(window.HTMLIFrameElement&&n instanceof window.HTMLIFrameElement)try{n=n.contentDocument.head}catch(e){n=null}t[e]=n}return t[e]}(e);if(!r)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");r.appendChild(n)}},540:e=>{e.exports=function(e){var t=document.createElement("style");return e.setAttributes(t,e.attributes),e.insert(t,e.options),t}},56:(e,t,n)=>{e.exports=function(e){var t=n.nc;t&&e.setAttribute("nonce",t)}},825:e=>{e.exports=function(e){if("undefined"==typeof document)return{update:function(){},remove:function(){}};var t=e.insertStyleElement(e);return{update:function(n){!function(e,t,n){var r="";n.supports&&(r+="@supports (".concat(n.supports,") {")),n.media&&(r+="@media ".concat(n.media," {"));var a=void 0!==n.layer;a&&(r+="@layer".concat(n.layer.length>0?" ".concat(n.layer):""," {")),r+=n.css,a&&(r+="}"),n.media&&(r+="}"),n.supports&&(r+="}");var i=n.sourceMap;i&&"undefined"!=typeof btoa&&(r+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(i))))," */")),t.styleTagTransform(r,e,t.options)}(t,e,n)},remove:function(){!function(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e)}(t)}}}},113:e=>{e.exports=function(e,t){if(t.styleSheet)t.styleSheet.cssText=e;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(e))}}},65:(e,t,n)=>{e.exports=n.p+"8001362869fa184779aa.svg"}},t={};function n(r){var a=t[r];if(void 0!==a)return a.exports;var i=t[r]={id:r,exports:{}};return e[r](i,i.exports,n),i.exports}n.m=e,n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{var e;n.g.importScripts&&(e=n.g.location+"");var t=n.g.document;if(!e&&t&&(t.currentScript&&"SCRIPT"===t.currentScript.tagName.toUpperCase()&&(e=t.currentScript.src),!e)){var r=t.getElementsByTagName("script");if(r.length)for(var a=r.length-1;a>-1&&(!e||!/^http(s?):/.test(e));)e=r[a--].src}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),n.p=e})(),n.b=document.baseURI||self.location.href,n.nc=void 0;var r=n(72),a=n.n(r),i=n(825),s=n.n(i),o=n(659),l=n.n(o),d=n(56),c=n.n(d),p=n(540),h=n.n(p),u=n(113),m=n.n(u),g=n(208),b={};b.styleTagTransform=m(),b.setAttributes=c(),b.insert=l().bind(null,"head"),b.domAPI=s(),b.insertStyleElement=h();a()(g.A,b);g.A&&g.A.locals&&g.A.locals;const y={events:{},subscribe:function(e,t){console.log(`PUBSUB: someone just subscribed to know about ${e}`),this.events[e]=this.events[e]||[],this.events[e].push(t)},unsubscribe:function(e,t){console.log(`PUBSUB: someone just UNsubscribed from ${e}`),this.events[e]&&(this.events[e]=this.events[e].filter((e=>e!==t)))},publish:function(e,t){console.log(`PUBSUB: Making an broadcast about ${e} with ${t}`),this.events[e]&&this.events[e].forEach((e=>{e(t)}))}},f={randomize:e=>{e.placeAllShipsRandomly();const t=e.render("edit"),n=document.querySelector(".editBoardArea");n.innerHTML="",n.appendChild(t)},renderCurrentPlayerEditBoard:async e=>{const t=e.getCurrentPlayer();if("P"===t.getPlayerType()){const n=document.querySelector(".container");n.innerHTML="";const r=document.createElement("div");r.className="boardsArea";const a=document.createElement("div");a.className="editBoard";const i=document.createElement("div");i.className="editBoardArea";let s=t.gameBoard.render("edit");const o=document.createElement("div");o.textContent="To rotate a selected ship press the Spacebar",o.style.alignSelf="center",o.style.fontSize="1rem";const l=document.createElement("div");l.className="btnsDiv";const d=document.createElement("h2");d.textContent=`Place your ships ${t.getPlayerID()}!`;const c=document.createElement("button"),p=document.createElement("span");p.textContent="Randomize",c.className="pushable",p.className="front",c.appendChild(p),c.addEventListener("click",(()=>{f.randomize(t.gameBoard)}));const h=document.createElement("button"),u=document.createElement("span");h.className="pushable",u.className="front",u.textContent="Confirm",h.appendChild(u),h.addEventListener("click",(()=>{t.ready=!0,e.canStartGame()?(e.nextPlayer(),y.publish("loadGamePage",e),"C"===e.getCurrentPlayer().getPlayerType()&&y.publish("playComputerTurn")):t.isReady()&&(e.nextPlayer(),f.renderCurrentPlayerEditBoard(e))})),l.appendChild(d),l.appendChild(c),l.appendChild(h),i.appendChild(s),a.appendChild(i),a.appendChild(o),r.appendChild(a),n.appendChild(r),n.appendChild(l)}else t.ready=!0,e.canStartGame()?(e.nextPlayer(),y.publish("loadGamePage",e),"C"===e.getCurrentPlayer().getPlayerType()&&y.publish("playComputerTurn")):t.isReady()&&(e.nextPlayer(),f.renderCurrentPlayerEditBoard(e))},render:async e=>{f.renderCurrentPlayerEditBoard(e)}},v=f,T=n.p+"1ded1e99216871d2a3ae.svg",C={render:e=>{const t=document.querySelector(".container");t.innerHTML="";const n=document.createElement("div"),r=document.createDocumentFragment();n.className="boardsArea",n.appendChild(e.render());const a=document.createElement("div");a.className="msgArea";const i=e.getCurrentPlayer(),s=document.createElement("h2");s.textContent=`${i.playerName}'s Turn`,a.appendChild(s),r.appendChild(n),r.appendChild(a),t.appendChild(r),y.subscribe("updateGameBoards",C.updateGameBoards),y.subscribe("updateCells",C.updateCells),y.subscribe("loadGameOverPage",C.gameOverPage),y.subscribe("bufferBoards",C.bufferBoards)},updateGameBoards:({gameBoardsDiv:e,currentPlayerName:t})=>{const n=document.querySelector(".boardsArea");n.innerHTML="",n.appendChild(e);document.querySelector(".msgArea h2").textContent=`${t}'s Turn`},updateCells(e){const t=e.boardDiv;for(let n=0;n<e.tiles.length;n++){const r=t.querySelector(`[tilerow='${e.tiles[n][0]}'][tilecol="${e.tiles[n][1]}"]`).querySelector(".cell");r.classList.remove("miss"),r.classList.remove("hit"),r.classList.remove("sunk"),r.classList.add(`${e.state}`)}},bufferBoards:({bufferBoards:e,currentPlayerName:t})=>{const n=document.querySelector(".boardsArea");n.innerHTML="",n.appendChild(e);document.querySelector(".msgArea h2").textContent=`Pass the Device to ${t}`},gameOverPage:({gameBoardsDiv:e,winner:t})=>{let n=document.querySelector(".container");n.parentNode.removeChild(n),n=document.createElement("div"),n.className="container";const r=document.createElement("div");r.className="boardsArea",r.appendChild(e);const a=document.createElement("h2");a.textContent="Computer"!==t?`Congratulation ${t}, You Won!`:"Computer Won";const i=document.createElement("button");i.className="pushable";const s=document.createElement("span");s.className="front",s.textContent="Start New Game",i.addEventListener("click",(()=>{location.reload()})),i.appendChild(s);const o=document.createElement("dialog");o.open=!0,o.className="gameOverDia";const l=document.createElement("button");l.className="closeDiaBtn";const d=document.createElement("img");d.src=T,l.appendChild(d),l.addEventListener("click",(()=>{o.close();const e=document.createDocumentFragment();e.appendChild(a),e.appendChild(i),n.appendChild(e)})),o.appendChild(l),o.appendChild(a.cloneNode(!0));const c=i.cloneNode(!0);c.addEventListener("click",(()=>{location.reload()})),o.appendChild(c),n.appendChild(r),n.appendChild(o),document.body.appendChild(n)}},S=C,P=n.p+"5b5f0638f5814e421dde.svg",L=n.p+"b11c92d13c528c2e74e1.svg",w=n.p+"f7c77d19e28c607c9eef.svg",B=n.p+"b34a09ef7b49efda4d7a.svg",E=n.p+"76c8890989b3a5543de1.svg",O=Object.freeze({VERTICAL:"VERTICAL",HORIZONTAL:"HORIZONTAL"});class x{#e=!1;#t="";#n="";#r;constructor(e){this.#t=e,this.startTile=[],this.shipDiv=this.render(),this.randomOrientation(),this.getShipLength()}#a=0;render(){const e=document.createElement("div");e.setAttribute("ship",this.getShipType()),e.classList.add("ship");const t=document.createElement("img");return t.className="shipImg",t.src=this.getShipImg(),e.style.height="100%",e.style.width="100%",t.style.height="100%",t.style.width=`calc(${100*this.getShipLength()}% + ${4*this.getShipLength()-4}px`,"HORIZONTAL"!==this.#n&&(e.style.transform="rotate(90deg)"),e.appendChild(t),e}isSunk(){return this.#a===this.#r&&(this.#e=!0),this.#e}hit(){this.#a<this.#r&&(this.#a=this.#a+1)}getShipLength(){switch(this.#t){case"CARRIER":return this.#r=5,this.#r;case"BATTLESHIP":return this.#r=4,this.#r;case"DESTROYER":case"SUBMARINE":return this.#r=3,this.#r;case"PATROL":return this.#r=2,this.#r}}randomOrientation=()=>{Math.random()<.5?this.#n=O.HORIZONTAL:this.#n=O.VERTICAL};changeShipOrientation(){this.#n===O.HORIZONTAL?this.#n=O.VERTICAL:this.#n=O.HORIZONTAL}getShipOrientation(){return this.#n}getShipImg=()=>{switch(this.#t){case"DESTROYER":return w;case"CARRIER":return P;case"SUBMARINE":return E;case"BATTLESHIP":return B;case"PATROL":return L}};getShipType(){return this.#t}}class A{#i=!1;constructor(){this.battleship}isHit(){return this.#i}hit(){return this.#i?"Tile was hit before":(this.#i=!0,this.hasShip()?(this.battleship.hit(),"Hit"):"Miss")}hasShip(){return void 0!==this.battleship}}class k{#s;#o=[new x("PATROL"),new x("SUBMARINE"),new x("DESTROYER"),new x("BATTLESHIP"),new x("CARRIER")];constructor(e){this.emptyBoard(e),this.pubsub=y}render=e=>{const t=this.#s.length,n=document.createElement("div");n.classList.add(e);const r=e=>{const t=e.startTile,n=e.getShipOrientation(),r=e.getShipLength();let a=[];if("HORIZONTAL"===n)for(let e=0;e<r;e++)a.push([t[0],t[1]+e]);else for(let e=0;e<r;e++)a.push([t[0]+e,t[1]]);return a};n.classList.add("gameBoard");for(let a=0;a<t;a++)for(let i=0;i<t;i++){const t=document.createElement("div"),s=document.createElement("div");s.classList.add("cell"),t.className="tile",t.setAttribute("tileRow",a),t.setAttribute("tileCol",i),t.appendChild(s);const o=this.#s[a][i];if(o.isHit()&&(o.hasShip()?o.battleship.isSunk()?s.classList.add("sunk"):s.classList.add("hit"):s.classList.add("miss")),"opp"===e){const o=()=>{const t=this.hitTile([a,i]);if("Miss"===t)s.classList.add("miss");else if("Hit"===t)if(this.#s[a][i].battleship.isSunk()){this.renderFleet(n,e);const t=r(this.#s[a][i].battleship);this.pubsub.publish("updateCells",{boardDiv:n,tiles:t,state:"sunk"})}else s.classList.add("hit");this.pubsub.publish("currentTurnResult",t)};t.addEventListener("click",o)}n.appendChild(t)}return this.renderFleet(n,e),n};renderFleet=(e,t)=>{this.#o.forEach((n=>{const r=n.startTile,a=e.querySelector(`[tilerow='${r[0]}'][tilecol="${r[1]}"]`).querySelector(".cell");n.shipDiv=n.render();const i=n.shipDiv;let s=n.getShipOrientation();i.setAttribute("startTileRow",`${r[0]}`),i.setAttribute("startTileCol",`${r[1]}`),i.setAttribute("currentOrientation",`${s}`);const o=i.querySelector(".shipImg");if("edit"===t){const t=e=>{e.stopPropagation()," "===e.key&&("HORIZONTAL"===s?(s="VERTICAL",i.style.transform="rotate(90deg)"):(s="HORIZONTAL",i.style.transform="rotate(0deg)"),l(e))},r=a=>{this.allShipsPlaced()&&(a.stopPropagation(),e.classList.add("movingShip"),this.removeShip(n),l(a),e.addEventListener("mousemove",d),e.addEventListener("click",c),o.removeEventListener("click",r),window.addEventListener("keydown",t))};o.addEventListener("click",r);const l=e=>{let t=parseInt(i.getAttribute("startTileRow")),r=parseInt(i.getAttribute("startTileCol")),a=e.target.closest(".tile"),l=null!==a?a.getAttribute("tilerow"):t,d=null!==a?a.getAttribute("tilecol"):r;this.canPlaceShip(n,[parseInt(l),parseInt(d)],s)?(o.classList.remove("cantPlace"),o.classList.add("canPlace")):(o.classList.remove("canPlace"),o.classList.add("cantPlace"))},d=e=>{let t=parseInt(i.getAttribute("startTileRow")),r=parseInt(i.getAttribute("startTileCol")),a=e.target.closest(".tile"),l=null!==a?a.getAttribute("tilerow"):t,d=null!==a?a.getAttribute("tilecol"):r;if((l!==t||d!==r)&&null!==a){i.setAttribute("starttilerow",l),i.setAttribute("starttilecol",d);const e=i.closest(".gameBoard").querySelector(`[tilerow='${l}'][tilecol="${d}"]`).querySelector(".cell");this.canPlaceShip(n,[parseInt(l),parseInt(d)],s)?(o.classList.remove("cantPlace"),o.classList.add("canPlace")):(o.classList.remove("canPlace"),o.classList.add("cantPlace")),e.appendChild(i)}},c=a=>{let l=n.startTile,p=a.target.closest(".tile"),h=null!==p?p.getAttribute("tilerow"):l[0],u=null!==p?p.getAttribute("tilecol"):l[1];const m=this.placeShip(n,[parseInt(h),parseInt(u)],s);if(e.removeEventListener("mousemove",d),e.removeEventListener("click",c),window.removeEventListener("keydown",t),o.classList.remove("canPlace"),o.classList.remove("cantPlace"),e.classList.remove("movingShip"),o.addEventListener("click",r),m)return n.getShipOrientation()!==s&&n.changeShipOrientation(),`${n.getShipType()} was moved`;{this.placeShip(n,n.startTile,n.getShipOrientation()),s=n.getShipOrientation(),"VERTICAL"===n.getShipOrientation()?i.style.transform="rotate(90deg)":i.style.transform="rotate(0deg)";const t=e.querySelector(`[tilerow='${l[0]}'][tilecol="${l[1]}"]`).querySelector(".cell");return t.innetHTML="",t.appendChild(i),`${n.getShipType()} can not be placed in this tile`}};a.appendChild(i)}else("current"===t||"oppShowShips"===t||"gameOver"===t||n.isSunk())&&a.appendChild(i)}))};allShipsPlaced=()=>{let e=[];const t=this.#s.length;for(let n=0;n<t;n++)for(let r=0;r<t;r++)this.#s[n][r].hasShip()&&this.#o.includes(this.#s[n][r].battleship)&&!e.includes(this.#s[n][r].battleship)&&e.push(this.#s[n][r].battleship);return e.length===this.#o.length};getShipCoordsFromTile(e){if(void 0!==this.#s[e[0]][e[1]].battleship){const t=this.#s[e[0]][e[1]].battleship,n=t.startTile,r=t.getShipOrientation(),a=t.getShipLength();let i=[];if("HORIZONTAL"===r)for(let e=0;e<a;e++)i.push([n[0],n[1]+e]);else for(let e=0;e<a;e++)i.push([n[0]+e,n[1]]);return i}}placeAllShipsRandomly(){this.emptyBoard(this.#s.length);const e=this.#o.length;for(let t=0;t<e;t++)this.#o[t].randomOrientation(),this.randomlyPlaceShipOnBoard(this.#o[t])}emptyBoard(e){if(e<=0)return"board size cannot be less or equal to zero";this.#s=Array(e);for(let t=0;t<e;t++){this.#s[t]=[];for(let n=0;n<e;n++)this.#s[t].push(new A)}return this.#s.length}randomlyPlaceShipOnBoard(e){let t=this.getStartTile(e,this.getRandomEmptyTileIndex());for(;!this.canPlaceShip(e,t);)t=this.getStartTile(e,this.getRandomEmptyTileIndex());this.placeShip(e,t)}getStartTile(e,t){let n;return"HORIZONTAL"===e.getShipOrientation()&&(n=t[0]+e.getShipLength()-1<10?t:[t[0]-e.getShipLength()+1,t[1]]),"VERTICAL"===e.getShipOrientation()&&(n=t[1]+e.getShipLength()-1<10?t:[t[0],t[1]-e.getShipLength()+1]),n}canPlaceShip=(e,t,n=e.getShipOrientation())=>{if(t[0]<0||t[1]<0||t[0]>=this.#s.length||t[1]>=this.#s.length)return!1;const r=e.getShipLength();if("HORIZONTAL"===n){if(r-1+t[1]>=this.#s.length)return!1;for(let e=0;e<r;e++)if(this.#s[t[0]][t[1]+e].hasShip())return!1}else{if(r-1+t[0]>=this.#s.length)return!1;for(let e=0;e<r;e++)if(this.#s[t[0]+e][t[1]].hasShip())return!1}return!0};getRandomEmptyTileIndex(){let e=this.getEmptyTilesIndex();return e[Math.floor(Math.random()*e.length)]}placeShip=(e,t,n=e.getShipOrientation())=>{if(this.canPlaceShip(e,t,n)){if(e.startTile=t,"HORIZONTAL"===n)for(let n=0;n<e.getShipLength();n++)this.#s[t[0]][t[1]+n].battleship=e;else for(let n=0;n<e.getShipLength();n++)this.#s[t[0]+n][t[1]].battleship=e;return!0}return!1};hitTile(e){return this.#s[e[0]][e[1]].hit()}hasStandingShips(){return this.#o.some((e=>!e.isSunk()))}tileShipSunk(e){return this.#s[e[0]][e[1]].battleship.isSunk()}getEmptyTilesIndex(){let e=[];for(let t=0;t<this.#s.length;t++)for(let n=0;n<this.#s[t].length;n++)this.isEmpty([t,n])&&e.push([t,n]);return e}isEmpty(e){return void 0===this.#s[e[0]][e[1]].battleship}getNotHitTiles(){let e=[];const t=this.#s.length;for(let n=0;n<t;n++)for(let r=0;r<t;r++)this.#s[n][r].isHit()||e.push([n,r]);return e}removeShip(e){const t=e.getShipLength(),n=e.startTile;if("HORIZONTAL"===e.getShipOrientation())for(let e=0;e<t;e++)this.#s[n[0]][n[1]+e].battleship=void 0;else for(let e=0;e<t;e++)this.#s[n[0]+e][n[1]].battleship=void 0}getShipTiles=e=>{const t=e.startTile,n=e.getShipOrientation(),r=e.getShipLength();let a=[];if("HORIZONTAL"===n)for(let e=0;e<r;e++)a.push([t[0],t[1]+e]);else for(let e=0;e<r;e++)a.push([t[0]+e,t[1]]);return a};getBoardLength=()=>this.#s.length}class N{#l="";#d="";#c="";#p;constructor(e,t){this.pubsub=y,this.ready=!1,this.#l=t,this.#d=e,this.gameBoard=new k(10),this.gameBoard.placeAllShipsRandomly(),this.setPlayerName(),this.emptyBoardHits(),"C"===e&&this.pubsub.subscribe("updateComputerHitBoard",this.updateComputerHitBoard)}emptyBoardHits=()=>{if("C"===this.#d){const e=this.gameBoard.getBoardLength();this.#c=Array(e);for(let t=0;t<e;t++){this.#c[t]=[];for(let n=0;n<e;n++)this.#c[t].push(0)}}};setEnemyBoardLength(e){this.enemyBoardLength=e}setPlayerName(e){void 0===e?"P1"===this.#l&&"P"===this.#d?this.playerName="Player1":"P2"===this.#l&&"P"===this.#d?this.playerName="Player2":"P2"===this.#l&&"C"===this.#d&&(this.playerName="Computer"):this.playerName=e}isReady=()=>this.gameBoard.allShipsPlaced()&&this.ready;getPlayerID(){return this.#l}getPlayerType=()=>this.#d;updateTiles=(e,t)=>{for(let n=0;n<e.length;n++)this.#c[e[n][0]][e[n][1]]=t};updateComputerHitBoard=({tiles:e,result:t})=>{let n=0;switch(t){case"hit":n=2;break;case"sunk":n=3;break;case"miss":n=1}this.updateTiles(e,n),3===n&&(this.#p=void 0),2===n&&void 0===this.#p&&(this.#p=e[0])};getStartTile=()=>{const e=this.enemyBoardLength;let t=[],n=[];for(let r=0;r<e;r++)for(let a=0;a<e;a++)0===this.#c[r][a]?t.push([r,a]):2===this.#c[r][a]&&n.push([r,a]);if(n.length>=1)this.#p=n[0],this.computerHit();else{let e=Math.round(Math.random()*(t.length-1));setTimeout((()=>{this.pubsub.publish("processComputerTurn",t[e])}),700)}};computerHit=()=>{let e;const t=(e,n)=>{if(null!==e){let r=[];if(2!==this.#c[e[0]][e[1]])return 0===this.#c[e[0]][e[1]]?e:void 0;switch(n){case"PX":if(r=[e[0],e[1]+1],r[1]<this.enemyBoardLength)return t(r,n);break;case"PY":if(r=[e[0]+1,e[1]],r[0]<this.enemyBoardLength)return t(r,n);break;case"NX":if(r=[e[0],e[1]-1],r[1]>=0)return t(r,n);break;case"NY":if(r=[e[0]-1,e[1]],r[0]>=0)return t(r,n)}}},n=["PX","NX","PY","NY"];let r=0;if(void 0===this.#p)this.getStartTile();else{for(;void 0===e&&r<n.length;)e=t(this.#p,n[r]),r++;setTimeout((()=>{this.pubsub.publish("processComputerTurn",e)}),700)}}}class I{#h="";#u="";constructor(e){this.#h=new N("P","P1"),this.#u=new N(e,"P2"),this.pubsub=y,this.pubsub.subscribe("currentTurnResult",this.currentTurnResult),this.pubsub.subscribe("playComputerTurn",this.playComputerTurn),this.pubsub.subscribe("processComputerTurn",this.processComputerTurn),this.pubsub.subscribe("gameOver",this.gameOver),"P"!==e&&this.#u.setEnemyBoardLength(this.#h.gameBoard.getBoardLength())}currentPlayer=Math.random()<.5?"P1":"P2";render=()=>{const e=document.createDocumentFragment();let t="",n="";return this.isOver()?(t=this.#h.gameBoard.render("gameOver"),n=this.#u.gameBoard.render("gameOver")):("P"===this.#u.getPlayerType()?"P1"===this.currentPlayer?(t=this.#h.gameBoard.render("current"),n=this.#u.gameBoard.render("opp")):(t=this.#h.gameBoard.render("opp"),n=this.#u.gameBoard.render("current")):"P1"===this.currentPlayer?(t=this.#h.gameBoard.render("current"),n=this.#u.gameBoard.render("opp")):(t=this.#h.gameBoard.render("oppShowShips"),n=this.#u.gameBoard.render("computer")),t.classList.add(`${this.#h.getPlayerID()}`),n.classList.add(`${this.#u.getPlayerID()}`)),e.appendChild(t),e.appendChild(n),e};currentTurnResult=e=>{if("Miss"===e){const e=this.getCurrentPlayer();this.nextPlayer();const t=this.render(),n=this.getCurrentPlayer().playerName;if("P"===this.#h.getPlayerType()&&"P"===this.#u.getPlayerType()){const r=document.createDocumentFragment(),a=e.gameBoard.render("buffer"),i=this.getCurrentPlayer().gameBoard.render("buffer");a.classList.add(`${e.getPlayerID()}`),i.classList.add(`${this.getCurrentPlayer().getPlayerID()}`);const s=document.createElement("button");s.classList.add("pushable"),s.classList.add("switchBtn");const o=document.createElement("span");o.className="front",o.textContent="Continue",s.appendChild(o),s.addEventListener("click",(()=>{s.remove(),y.publish("updateGameBoards",{gameBoardsDiv:t,currentPlayerName:n})})),r.appendChild(a),r.appendChild(i),r.appendChild(s),this.pubsub.publish("bufferBoards",{bufferBoards:r,currentPlayerName:n})}else this.pubsub.publish("updateGameBoards",{gameBoardsDiv:t,currentPlayerName:n}),"C"===this.getCurrentPlayer().getPlayerType()&&this.#u.computerHit()}else"Hit"===e&&this.isOver()&&this.pubsub.publish("gameOver")};playComputerTurn=()=>{this.#u.computerHit()};processComputerTurn=e=>{const t=document.querySelector(".P1");let n=[],r="";const a=this.#h.gameBoard.hitTile(e);"Miss"===a?(r="miss",n.push(e)):"Hit"===a&&(this.#h.gameBoard.tileShipSunk(e)?(n=this.#h.gameBoard.getShipCoordsFromTile(e),r="sunk"):(n.push(e),r="hit")),this.pubsub.publish("updateCells",{boardDiv:t,tiles:n,state:r}),this.pubsub.publish("updateComputerHitBoard",{tiles:n,result:r}),"Miss"===a||this.isOver()||this.#u.computerHit(),this.pubsub.publish("currentTurnResult",a)};nextPlayer(){"P1"===this.currentPlayer?this.currentPlayer="P2":this.currentPlayer="P1"}getCurrentPlayer(){return"P1"===this.currentPlayer?this.#h:this.#u}isOver(){return!this.#h.gameBoard.hasStandingShips()||!this.#u.gameBoard.hasStandingShips()}getWinner(){if(this.isOver())return this.#h.gameBoard.hasStandingShips()?this.#h.playerName:this.#u.playerName}canStartGame=()=>this.#h.isReady()&&this.#u.isReady();gameOver=()=>{const e=this.render(),t=this.getWinner();this.pubsub.publish("loadGameOverPage",{gameBoardsDiv:e,winner:t})}}const H={render:()=>{const e=document.querySelector(".container");e.innerHTML="";const t=document.createElement("div");t.className="mainMenuContainer";const n=document.createElement("div");n.className="opponentTypeArea";const r=document.createElement("div"),a=document.createElement("h2");a.textContent="VS.";const i=document.createElement("input");i.type="radio",i.id="typeComputer",i.name="opponentType",i.value="C",i.click();const s=document.createElement("label");s.setAttribute("for","typeComputer"),s.className="leftLabel";const o=document.createElement("span");o.textContent="Computer",o.className="front",s.appendChild(o);const l=document.createElement("input");l.type="radio",l.id="typePlayer",l.name="opponentType",l.value="P";const d=document.createElement("label");d.setAttribute("for","typePlayer"),d.className="rightLabel";const c=document.createElement("span");c.textContent="Player",c.className="front",d.appendChild(c),r.appendChild(i),r.appendChild(s),r.appendChild(l),r.appendChild(d),n.appendChild(a),n.appendChild(r);const p=document.createElement("div"),h=document.createElement("button");h.className="pushable";const u=document.createElement("span");u.textContent="Start Game",u.className="front",h.appendChild(u),h.addEventListener("click",H.startNewGame),p.appendChild(h),t.appendChild(n),t.appendChild(p),e.appendChild(t)},startNewGame:()=>{const e=document.querySelector("input[name='opponentType']:checked").value,t=new I(e);y.publish("loadEditPage",t)}},R=H;y.subscribe("loadEditPage",v.render),y.subscribe("loadGamePage",S.render),R.render()})();